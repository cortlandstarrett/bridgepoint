---

Copyright 2013 Mentor Graphics Corp.  All Rights Reserved.

---

# Gracefully handle corrupted connectors during reconciliation
### xtUML Project Implementation Note

1. Abstract
-----------
This note describes the changes required to prevent exceptions during
reconciliations when encountering a corrupted connector.

2. Document References
----------------------
[1] Issues 1, https://github.com/xtuml/doc/issues/65  
[2] ClearQuest DEI dts0100979019 - Component diagram interface connections
                                   cannot be edited

3. Background
-------------
A customer hit a situation where they could not disconnect interface references
in a package diagram.  Investigation showed that the cause was a corrupted
connector.  This connector was being used during reconciliation as a base for
a new connector that was to be created.  This corrupted connector did not have
any start or end element, which is expected by the reconciler.  An NPE was being
thrown due to the missing ends which caused the reconciliation transaction to
get reverted, which is the transaction that was disconnecting the graphics.

4. Requirements
---------------
4.1 When encountering a corrupted connector do not throw an exception, instead
    log an exception.

5. Work Required
----------------
5.1. Detect corrupted connection and log an exception

In ui.canvas::Model::newConnector(), before creating any graphical elements,
check the base connector for missing ends.  If both ends are missing log an
exception and return from the operation.

Two support logging an exception the following bridges are added with native
implementation:

CL::logException(String:message) - Simply calls CanvasPlugin.logException()
                                   which adds an entry to the log file
OS::uniqueIdToString(unique_id:id) - Returns a string representation of the UUID  
OS::newLine() - Returns a new line to be used for creating the error message

6. Implementation Comments
--------------------------

7. Unit Test
------------
_- Get xtuml/agilegc repo: git clone https://github.com/xtuml/agilegc.git  
_- Check out commit #9235a11: git checkout 9235a11  
_- Open up BridgePoint to a new workspace  
_- Import all existing projects from agilegc/models  
_- Import all existing projects from agilegc/test  
_- Open sys_channel_testbench::sys_channel test system in the canvas  
_- Right click on any interface satisfaction and select "Disconnect"  
_R An entry is added to the log file indicating a corrupted connection was found  
_- Attempt to separate the interface satisfaction that was just disconnected  
_R Can separate interface provider/requirer  

8. Code Changes
---------------
Branch name: Review-dts0100979019

com.mentor.nucleus.bp.ui.canvas/models/com.mentor.nucleus.bp.ui.canvas/
	ooaofgraphics/External Entities/External Entities.xtuml  
com.mentor.nucleus.bp.ui.canvas/models/com.mentor.nucleus.bp.ui.canvas/
	ooaofgraphics/Graphical Data/Model/Model.xtuml    
com.mentor.nucleus.bp.ui.canvas/src/com/mentor/nucleus/bp/ui/canvas/Cl_c.java    

End
---

