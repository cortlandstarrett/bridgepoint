---

Copyright 2013 Mentor Graphics Corp.  All Rights Reserved.

---

# Title goes here
### Length of dynamic array at creation time is 1


1. Abstract
-----------
Dynamic arrays are not being properly initialized during execution.  This issue
is raised to investigate and resolve this problem.

2. Document References
----------------------
[1] Issues 1, https://github.com/xtuml/doc/issues/133
[2] CQ Isssue dts0100798454 - This is the CQ issue associated with this problem.
[3] Bugzilla item 3085 (Establish fixed array lengths.)
This is the issue that was used to introduce support for fixed length arrays.,
http://tucson.wv.mentorg.com/bugzilla/show_bug.cgi?id=3085
[4] <svn>Documentation_archive/20121102/technical/notes/dts0100887931/dts0100887931.dnt 
This is the design note that describes the work done to implement fixed length arrays.

3. Background
-------------
A customer reported that when a class attribute (or other data element) is 
defined as a dynamic array using "[]" for the dimensions in the Properties 
window, the length of that array is 1 immediately after object instantiation. 
Additionally, attempting to access what appears to be a valid index 
(array[0]) results in a "unwritten array element - using default value" access 
error.

For example, given a class (c1) with a single attribute: 
integer dynamicArray[]

The problems are currently observed while stepping through OAL during execution: 
'''
create object instance class1 of c1;    // After this step, if you look at class1.dynamicArray in the variables  
                                        // view you will see it has a value of "Integer [1]".  At his point, this value should be  
                                        // "Integer [0]".  
dynArrLength = class1.dynamicArray.length;  // After this step, the value of dynArrLength is 1.  It should be 0.
 
dynArrElement = class1.dynamicArray[0]; // Stepping over this statement results in a warning: 
                                        // "Warning: access made to unwritten array element. Using default value."

4. Requirements
---------------
4.1 During execution, dynamic arrays shall have an initial length of 0.

5. Analysis
-----------
Fixed length arrays were introduced into BridgePoint in 2007 [3].  When this 
was done, a class named Dimensions was introduced and every model element
that may contain dimensions was given a new 1:M conditional association to this 
new Dimensions class.  The cardinality of this relationship represents the 
number of dimensions the model element has.   Prior to this change, each of 
these model elements contained an attribute named "Dimensions" or "Return 
Dimensions" that was of type Dimension_Type.  Dimension_Type was an Enumeration 
data type that had 9 values: One .. Eight (and None).  The value of One..Eight
contained text strings that look like this:
'''
[]
[][]
[][][]
'''
By default the tool set the value to "None" and in that case, the used would 
see a value of "0" for Dimension.  The tool managed the display in the 
properties view and the initialization of the attributes with several utility 
functions that served to convert the string-based representation defined in the 
Dimensions_Type enumeration into an integer value. 

When the Dimensions class was introduced the Dimensions_Type enumeration and its 
supporting utility functions were removed. With the fixed-length array support 
[3], the Dimensions/Return Dimensions attributes were changed from type 
Dimmension_Type to type string, and support was put in-place to allow the user
to create dimension strings of their own choosing by editing the Dimension/Return 
Dimension value in the properties view. This allowed users to create multi- 
dimensional arrays that were a mix of fixed-length and dynamic length.  For 
example:
'''
[][2][][2]
'''
An issue that had to be considered was how to differentiate a fixed-length 
array from a dynamic array.  The design describes this: [4 - 6.1.1.5]
'''
6.1.1.5 The 'Dimensions' class shall carry an integer attribute; 'elementCount'. 
        A value of 0 indicates that the array is dynamically sized.  Numeric 
        values of 1 or more indicate that it is a fixed-size array. Each 
        dimension of the array is limited to a different specified number of 
        elements.  
'''

Additionally, [4] states that for every model element with dimensions, a new 
operation shall be added to determine the number of dimensions:
'''
6.1.1.3 Each of these classes shall have an operation, getDimensionsCnt() or
        getReturnDimensionsCnt() that returns the number of dimensions.

		Example:
		        
        select many dims related by self->S_DIM[R51];
		dimensions = cardinality dims;
		return dimensions;
''' 

5.1  Analysis of the problem-case called out in the background above reveals
that the issue is that during instance creation the tool is not properly 
distinguishing the dynamic array from the fixed-length array.  It is using the 
<S_ATTR>.getDimensionsCnt() to initialize the size of the array. 

To resolve this problem we shall locate places where the tool is not properly 
distinguishing fixed length arrays from dynamic arrays during initialization 
and assure that fixed-length arrays are initialized with a length of 0.

An example of this problem is in Instance.initialize():
'''
      if empty sdt and attr.getDimensionsCnt() == 0
      ...
      else
        // This attribute is either a structured data type or an array, use
        // the runtime value defaulting mechanism to initialize it.
        rtVal.setDefault(dimensions:attr.getDimensionsCnt());
      end if;      
'''

6. Design
---------
In this section, describe in detail each step of the Work Required section of
the analysis, how the task will be accomplished, what technologies will
be used, algorithms, etc.

6.1 Some design point, with a code example
```java
    public void clearDatabase(IProgressMonitor pm) 
    {
        // clear the corresponding graphics-root's database
        OoaofgraphicsUtil.clearGraphicsDatabase(rootId, pm);

        Ooaofooa.getDefaultInstance().fireModelElementUnloaded(this);
    }
```

7. Design Comments
------------------
If research carried out during this phase shows that a requirement stated in the
analysis note is infeasible or needs some modification, enumerate those changes
here. If there was no preceding analysis note, then this section documents any
deviations from the design as presented at the design review.

8. Unit Test
------------
Outline all the unit tests that need to pass and describe the method that you
will use to design and perform the tests.

End
---

