---

Copyright 2013 Mentor Graphics Corp.  All Rights Reserved.

---

# Title goes here
### xtUML Project Design Note




1. Abstract
-----------
 

2. History
----------
 
 

3. Document References
----------------------
[1] /Documentation/internal/technical/notes/dts0100629397/dts0100629397.ant  
[2] https://github.com/xtuml/internal/blob/master/doc-internal/notes/dts0100629397/ 


4. Background
-------------
 n/a

5. Requirements
---------------
5.1. Models executing in BridgePoint shall communicate with other tools 
     through a BridgePoint SVX interface.  
5.2. Port marking shall be used to identify the modeled components that 
     shall participate in SVX communication.  
5.3. A model executing in BridgePoint and communicating with other 
     models through SVX shall not need to be aware of the 
       algorithms in the other models. 
5.4 The port marked as svx should have a kind of graphical represntation 
     that distiguieshes it from the regular port
    [tbd_7.2.2]
   
   
6. Analysis
-----------
refer to the analysis note [1] 


7. Design 
---------
7.1 To be able to use SVX APIs, it is needed to add svx.jar to the bp core 
    plugin dependencies 
    modify the the generate.xml to add the svx.jar dependency 
	modify class path svx.jar to add svx.jar entry  

7.2 Add attribute to the metamodel class Port to mark it as svx.
    While running verifier that attribute is checked if it is true then the 
    communication is being routed to get or set values using the SVX APIs
    That attribute is of type boolean and named isSVX and its 
    full name is Mark As SVX.  
 
7.3 Port configurations for the SVX channel configuration of each project: 
    The Port preferences are accessed to be configured from the SVX project 
    preferences menu item.  
7.3.1 Create an SVX project preference node that shows on the xtuml project when
      selected from model explorer view   
7.3.2 Modify create_core_plugin_class.arc to add the SVX preferences node to the
      core plugin  
7.3.3 Create SVX preferences page that is used to configure the ports marked as 
      svx. The preferences page shows a drop down list containing only the 
      components that has at least one port marked as svx.
	  When a component is selected a table showing all the ports marked as svx 
	  on the selected component.
	  When a port on that table is selected a check is shown next to the port 
	  name then all the configurations for that port become editable.
	  Then a secondary table shows all the interface operations along with their  	  
	  corresponding configurable SVX signal names.  
	  
7.3.3.1 Port configuration table : 
        There will be no initial values for the fields of this table 
		After the first save the table fields will be populated by the values 
		provided by the user. 
		These values will be persisted in a file that lives under the folder 
		".settings" in the project.
		
		The table columns are:
		
        Port Name : not editable
		Channel Name:  This represents the SVX channel name associated with 
		               the port
		Port Number :  The port number for SVX communications to go through
		isAppSequencer : Represents the client that will run first for svx 
		                 (the client with the value false runs first)
		iP         :   The ip for SVX communications to go through
		lookUpName :   A name provided for the SVX channel to be looked up in 
		               the system (left empty)
		seconds    :   The amount of time that is advanced after each execute 
		value      :   The a magnitude of the time as enumerated steps in 
		               orders of 1000 (supported values are only from 0 to 999)
		BIGendTime :   The value of time where it would mark the end of the 
		               communication.
	The columns won't be provided a default value is to force the user to enter 
	the value that will make the correct communication with the other svx 
	clients running, else the user might be under the false impression that the 
	default values might make his model up and running correctly without 
	being modified. 
	If the values were not provided in this table an error message will show in 
	a verifier session if a user tried to communicate to SVX channel without 
	having these values set first 
    the error message will be: 
    "No Channel Configuration Was provided for Port : Port_Name  no
     svx connection is established"	
	
7.3.3.2 Signal Name configuration table:
        The table shows all the interface operations associate with the selected
        port on the first table 
		Each Interface Operation is associated with a signal name 
		The table columns are:
		Executable Property : Not Editable
		Signal Name : represents the SVX signal name 011
    
7.3.4 Create SVX preferences store that contains the mapping between ports and 
      created channels for them. 
      The store is also responsible for persisting the maps in files under 
      ".settings" folder of the project.
	  The two files persisted are explained below:
7.3.4.1 The first file maps the port to a created SVX channel corresponding to 
        that port the svx channel class[7.3.5]
7.3.4.2 The second file maps the executable properties to it's corresponding 
        signal name. 

7.3.5 SVXChannel class represents the svx channel created holding its 
      configuration values the values are populated from the table in the 
      preferences window [7.3.3.1]
      class SVXChannel {
	  String portName;
	  String channelName;
	  int portNumber;
	  boolean isAppSequencer;
	  String iP;
	  String lookUpName;
	  double seconds;
	  int value;
	  double BIGendTime;
       }
 
7.4 Add External entity for communication between OAL and java SVX APIs 
    the implementation to that external entity is not generated it is
	coded in java that holds the communication with the svx APIs
	that external entity is named SVX it has two bridge operations:
7.4.1 The first bridge opration is named getSVXValue()
      this operation has a return type of real
	  this one is used to read the value provided for certain signal from the 
	  SVX bus it has two parameters of type UUID there parameters are 
	  messageValueId and portId there parameters are used to resolve the right 
	  svx channel and signal name configured for the value being read
7.4.2 The second bridge operation is named setSVXValue() this one is used to 
      send an svx value to SVX this one has three parameters of the type uuid 
	  these are valueId, portId and  invocationId they are used to resolve the 
	  right port and the value being sent to the port along with the configured 
	  signal name.


7.7 SVX_C implementation code  
    This Java class hold the code implementation for the External entity named 
    SVX mentioned above the main operations of this class are:	
7.7.1 Getsvxvalue() this operation has a return type Object that gets converted 
      to float value represents the float value that is retrieved from the SVX 
	  This operation has two parameters of the type UUID 
      The first is Messagevalueid this one represents the ID of the message that
      is been used to get the svx value.
	  The second is Portid this one represents the id of the port through which 
	  the SVX communication goes.
      After resolving the port, it gets checked if initialized first, if it 
      wasn't then it gets initialized. 
	  Then use SVX API's to read the desired value on that SVX channel.
	  A check is made to make sure that the current svx time is less than the 
	  big end time configured.
      If the current time is less than the big end time then the value is read
       using the svx API's and time is advanced. 	  
	  If the current time exceeded the big end time an error message is shown 
	  to the user as follows:
	  "This  Channel : <channel_name> that is associated with the port : 
	  <port_Name> has times out 
	  and value of 0.0 will be returned. Try Increasing the Big End Time"
	  
7.7.2 Setsvxvalue() this operation is of type void. It has three parameters of 
      type UUID valueId, portId and invocationId.  They are used to resolve the 
      float value that is meant to be sent to the svx channel, the port through 
      which the communication goes and the interface operation that was invoked 
      to send this value to the svx channel.
	  After resolving the port, it gets checked if initialized first, if it 
	  wasn't then it gets initialized. 
	  Then use SVX API's to send the resolved value to that SVX channel.
	  A check is made to make sure that the current svx time is less than the 
	  big end time configured.
      If the current time is less than the big end time then the value is sent 
      using the svx API's and time is advanced. 	  
	  If the current time exceeded the big end time an error message is shown to
	  the user as follows:
	  "This  Channel : <channel_name> that is associated with the port : 
	  <port_Name> has times out Try Increasing the Big End Time"

7.7.3 Initialize() this operation creates svx channel associated with each port 
      using the configuration values provided by the SVX preferences. 
      Then starts up the svx system.
	  If the associated channel attribute isAppSequencer was marked as true
	  A connection connector sockets are created and an SVXComponentChannel 
	  component channel is created.
	  If it is marked as false then connection acceptor sockets are created and 
	  not a channel.
	  It is an SVX convention that the SVX component channel is created at the 
	  side where isAppSequencer is marked as false.
	  Then this method creates the SVX consumers and generators associated with 
	  each SVX channel that corresponds to a component port.
	  This consumers/generators are created according to the following:
	   - If the port is a requirement and the the interface operation direction 
	     is from provider then a consumer is created. 
	   - If the port is a provision and the the interface operation direction is
	     to provider then a consumer is created.
      Then the the consumerMap hashmap gets populated with the value of UUID of 
      the interface operation along with the ISVXNativeHandle
      representing the consumer created
   
	   - If the port is a requirement and the the interface operation direction 
	     is to provider then a generator is created.
	   - If the port is a provision and the the interface operation direction is
	     from provider then a generator is created.
      
	  Then the the generatorMap hashmap gets populated with the value of UUID of
	  the interface operation along with the ISVXNativeHandle
      representing the generator created
	 	   
	  Then the svx system is started up and hashmaps gets populated as follows:
	  svxNativeJNIMap : maps the SVXNativeJNI to the UUID of the xtuml component
	                    port associated with the svx channel
      targetMap       : maps the target of the svx channel to the UUID of the 
                        xtuml component port
      factoryMap      : maps the factory of the svx channel to the UUID of the 
                        xtuml component port
      
      After a successful initialization a message is shown to the user  
      			User_c.Loginfo("The channel : " + retSvxChannel.getChannelName()
					+ "that is associated with the port : " + port.getName()
					+ " was initialized successfully"); 

			
7.5 Modify the operation getValue() of the class message value:
    When This operation can't resolve the needed value returns a default value,
    but an extra case is added to check if the port through which this value is
    read is marked as svx port. Then the SVX::getSVXValue() bridge operation is 
    called and having the right uuid paramters sent to it this operation gets 
    the right sxv handles that resolves the value on the desired 
    svx channel and signal name.   
    when the value is resolved using the java code implementation of that bridge 
    operation.
	Then a return value instance is created that has a data type of type real 
	related to it. 
	Then the value that is resolved is set to the resolved value.
	That's how the resolved values from svx is returned to the oal code format.
 	

7.6  Modify the opratoin excute() in IntrfaceInvocation metamodel class 
     this operation is modified that when it's loose and not connected to other
	 port then when an operation is called across that port to send a value to svx 
     bus using the bridge operation SVX::getSVXValue() passing the right parameters 
     to that bridge operation the value being sent to the svx is being resolved 
     along with it's originating port and signal name 
     that part is executed in the java implementation to that bridge operation 	 



8. Design Comments
------------------
8.1 This current implementation supports only operation calls to get or send float 
    values to SVX channel. It does not interact with timers in verifier.
8.2  Show a graphical representation of the port marked as svx 
     along with an indication that the svx connections has been established 
     correctly during the verifier run. is not implemented yet 		
	
9. Work Required
----------------
Stated in the Design section 

10. Unit Test
------------
10.1 Run SVX created demo
     _- Run java project svx_dummy as java application
     _- Launch test project in xtuml verifier 
	 _- navigate to test>comp>pkg>fn
	 _- execute funtion fn
	 R-Returns the correct values 

End
---
